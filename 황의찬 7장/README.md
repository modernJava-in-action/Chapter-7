# Chapter 7 - 병렬 데이터 처리와 성능
외부 반복 -> 내부 반복으로 바꾸면 네이티브 자바 라이브러리가 스트림 요소의 처리를 제어할 수 있습니다.  
컴퓨터의 멀티코어를 활용해서 파이프라인 연산을 실행할 수 있다는 점이 가장 중요한 특징입니다.  
  
예를 들어 Java 7이 등장하기 전에는 데이터 컬렉션을 병렬로 처리하기가 어려웠습니다.과정은 다음과 같습니다.  
1. 우선 데이터를 서브파트로 분할  
2. 분할된 서브파트를 각각의 스레드로 할당  
3. 스레드로 할당한 다음에는 의도치 않은 레이스 컨디션이 발생하지 않도록 적절한 동기화  
4. 마지막으로 부분 결과를 합침  
Java 7은 더 쉽게 병렬화를 수행하면서 에러를 최소화할 수 있도록 `포크/조인 프레임워크` 기능을 제공합니다.  

여러 청크(정보 조각)를 병렬로 처리하기 전에 병렬 스트림이 요소를 여러 청크로 분할하는 방법을 설명합니다.  
커스텀 Spliterator를 직접 구현하면서 분할 과정을 우리가 원하는 방식으로 제어하는 방법도 설명합니다.    
  
## 7.1 병렬 스트림
컬렉션에 parallelStream을 호출하면 병렬 스트림이 생성됩니다.  
**병렬 스트림이란 각각의 스레드에서 처리할 수 있도록 스트림 요소를 여러 청크로 분할한 스트림입니다.**  
따라서 병렬 스트림을 이용하면 모든 멀티코어 프로세서가 각각의 청크를 처리하도록 할당할 수 있습니다.  
  
숫자 n을 인수로 받아서 1부터 n까지의 모든 숫자의 합계를 반환하는 메서드를 구현한다고 가정해봅니다.  
무한 스트림을 만든 다음에 인수로 주어진 크기로 스트림을 제한하고, 두 숫자를 더하는 BinaryOperator로 리듀싱 작업을 수행할 수 있습니다.  
```java
public static long sequentialSum(long n) {
		return Stream.iterate(1L, i -> i + 1)
			.limit(n)
			.reduce(0L, Long::sum);
	}
```
전통적인 자바에서는 다음과 같이 반복문으로 이를 구현할 수 있습니다.  
```java
public long iterativeSum(long n) {
		long result = 0;
		for (long i = 1L; i <= n; ++i) {
			result += i;
		}
		return result;
	}
```
특히 n이 커진다면 이 연산을 병렬로 처리하는 것이 좋을 것입니다.  
결과 변수는 어떻게 동기화해야 할까? 몇 개의 스레드를 사용해야 할까? 숫자는 어떻게 생성할까? 생성된 숫자는 누가 더할까?  
  
병렬 스트림을 이용하면 걱정, 근심 없이 모든 문제를 쉽게 해결할 수 있습니다.  
  
### 7.1.1 순차 스트림을 병렬 스트림으로 변환하기




